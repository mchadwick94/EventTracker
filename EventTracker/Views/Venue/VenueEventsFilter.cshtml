@using Microsoft.AspNet.Identity
@model IEnumerable<Tracker.Data.tbl_events>
<link href="~/Content/StyleSheet.css" rel="stylesheet" />
@{
    ViewBag.Title = "VenueEventsFilter";
    ViewBag.Venue = Convert.ToInt32(Request.QueryString["Event_Venue"]);
}
<body>
    <div class="card" id="venue-event-filter-card">
        <div class="input-group" id="input-div">
            @Html.Editor("Event_Name", new { htmlAttributes = new { @id = "eventNameFilter", @placeholder = "Enter Event Name...", @onkeyup = "delayFilter()", @autocomplete = "off" } })
        </div>
        <div class="input-group"id="input-date-div">
            @Html.Editor("Start Date", new { htmlAttributes = new { @id = "startdatepicker", @placeholder = "Search From...", @autocomplete = "off" } })
        </div>
        <div class="input-group" id="input-date-div">
            @Html.Editor("End Date", new { htmlAttributes = new {  @id = "enddatepicker", @placeholder = "Search To...", @autocomplete = "off" } })
        </div>
        </div>

    <div class="card" id="venue-event-card">
        @{Html.RenderAction("GetEventsforVenue", "Event");} @*TEST FOR EVENT FILTERING*@
    </div>
</body>
<style>
</style>
@section Scripts {

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/bootstrap")

    @*Script modified from: https://stackoverflow.com/questions/41564427/how-to-refresh-html-dropdowngrouplist-after-another-dropdown-changes*@

    <script>
        var typingTimer;                //timer identifier
        var doneTypingInterval = 400;  //time in ms
        var $input = document.getElementById("eventNameFilter");
        function delayFilter() {
            //setup before functions
            clearTimeout(typingTimer);
            if (typingTimer == doneTypingInterval) {
                typingTimer = setTimeout(filterByName, doneTypingInterval);
            } else {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(filterByName, doneTypingInterval);
            }
        }

        function filterByName() {
            var input = document.getElementById("eventNameFilter");
            var eventName = input.value;
            var searchString = eventName.replace(/ /g, '**');
            var startDateObject = $('#startdatepicker').datepicker('getDate');
            var startDate = $.datepicker.formatDate('yy/mm/dd', startDateObject);
            var endDateObject = $('#enddatepicker').datepicker('getDate');
            var endDate = $.datepicker.formatDate('yy/mm/dd', endDateObject);
            var venueval = '@ViewBag.Venue'; //val is set to the text value of the dropdown.;
            $("#venue-event-card").load("/Event/GetEventsforVenue?Event_Venue=" + venueval + "&Event_Name=" + searchString + "&Search_Start_Date=" + startDate + "&Search_End_Date=" + endDate);
        }
    </script>

   


    <link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
    @*Script below for the datepicker was found here: https://www.youtube.com/watch?v=Yuo2XX5_rYo*@

    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script>
        $(function () {
            $("#startdatepicker").datepicker({
                dateFormat: "dd/mm/yy",
                changeMonth: true,
                changeYear: true,
                //yearRange: "-0:+2",
                showOn: "both",
                buttonText: "Select",
                showButtonPanel: true

            });
        })
        $(function () {
            $("#enddatepicker").datepicker({
                dateFormat: "dd/mm/yy",
                changeMonth: true,
                changeYear: true,
                //yearRange: "-0:+2",
                showOn: "both",
                buttonText: "Select",
                showButtonPanel: true
            });
        })
    </script>
    <script>
        function DateFilter() {
            var startDateObject = $('#startdatepicker').datepicker('getDate');
            var startDate = $.datepicker.formatDate('yy/mm/dd', startDateObject);
            var endDateObject = $('#enddatepicker').datepicker('getDate');
            var endDate = $.datepicker.formatDate('yy/mm/dd', endDateObject);
            var input = document.getElementById("eventNameFilter");
            var searchString = input.value;

            var venueval = ViewBag.Venue.value; //val is set to the text value of the dropdown.;
            $("#user-event-card").load("/Event/GetEventsforVenue?Event_Venue=" + venueval + "&Event_Name=" + searchString + "&Search_Start_Date=" + startDate + "&Search_End_Date=" + endDate);
        }

        $('#startdatepicker').change(function (e) {
            var startDateObject = $('#startdatepicker').datepicker('getDate');
            DateFilter();
            $("#enddatepicker").datepicker("option", "minDate", startDateObject);
        });

        $('#enddatepicker').change(function (e) {
            var endDateObject = $('#enddatepicker').datepicker('getDate');
            DateFilter();
            $("#startdatepicker").datepicker("option", "maxDate", endDateObject);

        });</script>

}

<style>
    .input-group{
        margin: 0 5% 0 5%;
        display: inline-flex;
    }
    #venue-event-filter-body{
        width: 100%;
    }
    #venue-event-card{
        height: 85%;
    }

    #venue-event-filter-card{
            margin: 0 !important;
    width: 100%;
    background-color: #68bc51;
    border: 5px medium grey;
    border-radius: 20px;
    padding: 1% 5% 1% 5%;
    box-shadow: 0 0 10px grey;
    color: #222;
    font-weight: 700;
    height: 8%;
    display: inline-flex;
    position:center;
    }

    .venue-event-filter-options{
        width: 100%;
        padding: 5% 0 5% 0;
    }

    #input-div{
        height: 60% !important;
    }   
    
    #input-date-div{
        height: 60% !important;
    }
</style>